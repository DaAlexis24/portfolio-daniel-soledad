---
import { Download, Moon, SunMedium } from "@lucide/astro"
import menus from '../collections/menu.json'
import Button from './ui/Button.astro'
import Logo from "../assets/Logo.astro"
---

<header role="banner" class="sticky top-0 z-50 bg-linear-65 from-radiant via-blue-100 to-radiant backdrop-blur-md shadow-2xl shadow-shadow-header dark:from-gray-900 dark:via-gray-700 dark:to-gray-900 dark:shadow-gray-600">
    <div class="relative mx-auto flex items-center justify-between px-4 max-w-5xl h-15 md:gap-x-4">
        <div class="h-18 bg-linear-to-r from-radiant via-light-blue to-radiant my-auto px-8 rounded-b-2xl shadow-xs shadow-gray-400 dark:from-gray-900 dark:via-gray-700 dark:to-gray-900 dark:shadow-gray-600">
            <div class="h-25 flex justify-center items-center bg-linear-65 from-radiant via-light-blue to-radiant p-8 rounded-lg shadow-2xl shadow-gray-600 dark:from-gray-900 dark:via-gray-700 dark:to-gray-900 dark:shadow-red-600">
                <div class="h-16 w-16 drop-shadow-lg drop-white transition transform-3d duration-300 ease-in hover:scale-105 dark:drop-shadow-orange-700">
                    <a href="/">
                        <Logo class={"animate-fade-in-down"} width={64} height={64} />
                    </a>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex flex-row-reverse justify-start w-full text-sm tablet:justify-end tablet:flex-row tablet:items-center" role="navigation">
            <!-- Mobile Menu Toggle Buttons -->
            <div class="flex items-center gap-2 tablet:hidden">
                <!-- Dark Mode Toggle (Mobile) -->
                <div id="darkToggleMobile" class="flex items-center justify-center w-10 h-10 cursor-pointer rounded-full bg-linear-to-b from-white to-[#edeefa] border-[0.5px] border-[#f3f3ff] dark:from-neutral-800 dark:to-neutral-600 dark:border-neutral-600 transition-transform duration-200 active:scale-95">
                    <div class="flex justify-center items-center w-6 h-6 relative overflow-hidden rounded-full bg-[#7fa1ff] bg-linear-to-b from-light-blue to-dark-blue border-[0.5px] border-[#7fa1ff] dark:from-dire dark:to-red-500 dark:border-red-800" style="box-shadow: 0px 2px 3px 0 rgba(55,52,209,0.21);">
                        <SunMedium class="absolute hidden text-white w-4 h-4 transition duration-200 transform ease mobile-sun" /> 
                        <Moon class="absolute hidden text-white w-4 h-4 transition duration-200 transform ease mobile-moon" />
                    </div>
                </div>

                <!-- Hamburger Menu Button -->
                <div id="openMenu" class="flex items-center justify-center w-10 h-10 cursor-pointer transition-transform duration-200 active:scale-90">
                    <svg class="w-7 h-7 text-dark-blue dark:text-light-blue" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M20 7L4 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path> <path d="M20 12L4 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path> <path d="M20 17L4 17" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path> </g></svg>
                </div>

                <!-- Close Menu Button -->
                <div id="closeMenu" class="hidden items-center justify-center w-10 h-10 cursor-pointer transition-transform duration-200 active:scale-90">
                    <svg
                    class="w-6 h-6 text-acero dark:text-light-gray"
                    fill="none"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    viewBox="0 0 24 24"
                    stroke="currentColor"><path d="M6 18L18 6M6 6l12 12"></path></svg>
                </div>
            </div>

            <!-- Menu Items -->
            <div id="menu" class="fixed top-17 tablet:top-0 left-3 right-3 tablet:left-0 tablet:right-0 ease-out duration-300 z-40 flex-col items-center justify-start hidden w-auto h-auto text-sm pt-6 pb-5 tablet:py-0 tablet:relative tablet:flex-row tablet:flex">
                <!-- Mobile Menu Background -->
                <div class="absolute inset-0 top-0 right-0 block w-full h-full tablet:hidden">
                    <div class="relative w-full h-full bg-light-blue border border-dashed border-neutral-300 dark:border-neutral-700 backdrop-blur-md rounded-2xl dark:bg-gray-900/85 shadow-lg">
                    </div>
                </div>

                <!-- Menu Links -->
                <div class="relative z-10 flex flex-col tablet:flex-row items-center w-full tablet:w-auto gap-1 tablet:gap-0">
                    {
                        menus.map((menu) => {
                            return (
                            <a href={menu.url} class="relative flex items-center justify-center w-full tablet:w-auto px-5 py-2.5 tablet:py-2 tablet:px-3 md:px-4 font-roboto tracking-wide text-center duration-200 ease-out rounded-lg tablet:rounded-none text-light-black dark:text-neutral-200 hover:text-dark-blue tablet:hover:bg-transparent dark:hover:text-white dark:hover:bg-neutral-800/50 tablet:dark:hover:bg-transparent active:scale-[0.98] tablet:active:scale-100 transition-all" rel="noopener noreferrer">{menu.item}</a>
                            )
                        })
                    }
                </div>

                <!-- Contact Button (Mobile) -->
                <div class="relative z-10 w-full px-5 mt-3 tablet:hidden text-white">
                    <Button url="/cv.pdf" download="Daniel-Soledad-CV.pdf" type="fill" className="m-auto w-full justify-center">
                        Mi CV <Download size={16} />
                    </Button>
                </div>
            </div>

            <!-- Desktop Actions -->
            <div class="relative hidden tablet:flex items-center gap-2 ml-4 lg:ml-6">
                <!-- Contact Button (Desktop) -->
                <Button type="fill" className="md:flex mx-1" url="/cv.pdf" download="Daniel-Soledad-CV.pdf">
                    Mi CV <Download size={16} />
                </Button>

                <span class="separator-line hidden tablet:inline-block bg-[rgba(183,202,255,0.5)] mt-5 -translate-y-1/2 w-px h-5"></span>

                <!-- Dark Mode Toggle (Desktop) -->
                <div id="darkToggle" class="relative flex items-center h-9 px-2 gap-1.5 font-medium cursor-pointer rounded-full bg-linear-to-b from-white to-[#edf1fa] border-[0.5px] border-light-blue dark:from-neutral-800 dark:to-neutral-600 dark:border-neutral-600 transition-all duration-200 hover:shadow-md hover:scale-105 active:scale-95 mx-1">
                    <div class="flex justify-center items-center shrink-0 w-6 h-6 relative overflow-hidden rounded-full bg-linear-to-b from-[#85a6ff] to-[#2d6dc3] border-[0.5px] border-[#7fa1ff] dark:from-dire dark:to-red-500 dark:border-red-800" style="box-shadow: 0px 2px 3px 0 rgba(55,52,209,0.21);">
                        <SunMedium id="sun" class="absolute hidden text-white w-4 h-4 transition duration-200 transform ease" />
                        <Moon class="absolute hidden text-white w-4 h-4 transition duration-200 transform ease" id="moon" />
                    </div>
                    <span class="hidden tablet:inline-block whitespace-nowrap font-montserrat">
                        <span id="dayText" class="shrink-0 text-sm text-left text-light-black dark:text-neutral-400">Light</span>
                        <span id="nightText" class="hidden shrink-0 text-sm text-left text-[#6f6c8f] dark:text-white">Dark</span>
                    </span>
                </div>
            </div>
        </nav>
    </div>
</header>

<style>
     /* Mobile menu animation */
  @media (max-width: 783px) {
    #menu {
      transform: translateY(-10px);
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    #menu:not(.hidden) {
      transform: translateY(0);
      opacity: 1;
      pointer-events: auto;
    }
  }

  /* Menu item hover effect optimization */
  nav a {
    position: relative;
  }

  /* Desktop underline animation */
  @media (min-width: 783px) {
    nav a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%) scaleX(0);
      width: 70%;
      height: 2px;
      background: var(--color-bright-blue);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 2px;
    }

    nav a:hover::after {
      transform: translateX(-50%) scaleX(1);
    }
  }

  /* Desktop underline animation — Dark mode */
  @media (min-width: 783px) {
    :global(.dark) nav a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%) scaleX(0);
      width: 70%;
      height: 2px;
      background: var(--color-dire);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 2px;
    }

    :global(.dark) nav a:hover::after{
      transform: translateX(-50%) scaleX(1);
    }
  }

  /* Mobile menu item click feedback */
  @media (max-width: 783px) {
    nav a:active {
      background-color: var(--color-bright-blue);
    }

    .dark nav a:active {
      background-color: rgba(255, 255, 255, 0.05);
    }
  }


  /* Dark mode toggle button optimization */
  #darkToggle,
  #darkToggleMobile {
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  /* Mobile menu background blur effect enhancement */
  @supports (backdrop-filter: blur(12px)) {

    @media (max-width: 783px) {
      #menu > div > div {
        backdrop-filter: blur(16px);
      }
    }
  }

  /* Ensure Logo doesn't shrink on mobile */
  .flex-shrink-0 {
    min-width: fit-content;
  }

  /* Tablet compact layout */
  @media (min-width: 640px) and (max-width: 767px) {
    nav a {
      padding-left: 0.5rem;
      padding-right: 0.5rem;
      font-size: 0.8125rem;
    }
  }

  /* Prevent horizontal scrolling on mobile */
  @media (max-width: 783px) {
    body {
      overflow-x: hidden;
    }
  }

  /* Optimize mobile touch feedback */
  @media (max-width: 783px) {
    button, a, [role="button"] {
      -webkit-tap-highlight-color: transparent;
    }
  }

  /* Ensure mobile menu has good shadow */
  @media (max-width: 783px) {
    #menu > div > div {
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1),
                  0 8px 10px -6px rgba(0, 0, 0, 0.05);
    }

    :global(.dark) #menu > div > div {
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3),
                  0 8px 10px -6px rgba(0, 0, 0, 0.2);
    }
  }
</style>

<script is:inline>
    // Solo ejecuta en cliente, sin procesamiento de Astro
    const darkToggle = document.getElementById('darkToggle');
    const darkToggleMobile = document.getElementById('darkToggleMobile');
    const openMenu = document.getElementById('openMenu');
    const closeMenu = document.getElementById('closeMenu');
    const menu = document.getElementById('menu');
    let isMobileMenuOpen = false;

    function syncDarkModeIcons() {
        const isDark = document.documentElement.classList.contains('dark');
        const sunIcons = document.querySelectorAll('#sun, .mobile-sun');
        const moonIcons = document.querySelectorAll('#moon, .mobile-moon');
        
        if (isDark) {
            moonIcons.forEach(icon => icon.classList.remove('hidden'));
            sunIcons.forEach(icon => icon.classList.add('hidden'));
            document.getElementById('dayText')?.classList.add('hidden');
            document.getElementById('nightText')?.classList.remove('hidden');
        } else {
            sunIcons.forEach(icon => icon.classList.remove('hidden'));
            moonIcons.forEach(icon => icon.classList.add('hidden'));
            document.getElementById('dayText')?.classList.remove('hidden');
            document.getElementById('nightText')?.classList.add('hidden');
        }
    }

    function toggleDarkMode() {
        const html = document.documentElement;
        html.classList.toggle('dark');
        localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
        syncDarkModeIcons();
    }

    function openMobileMenu() {
        menu?.classList.remove('hidden');
        openMenu?.classList.add('hidden');
        closeMenu?.classList.remove('hidden', 'flex');
        closeMenu?.classList.add('flex');
        document.body.style.overflow = 'hidden';
        isMobileMenuOpen = true;
    }

    function closeMobileMenu() {
        menu?.classList.add('hidden');
        closeMenu?.classList.add('hidden');
        closeMenu?.classList.remove('flex');
        openMenu?.classList.remove('hidden');
        document.body.style.overflow = '';
        isMobileMenuOpen = false;
    }

    // Event listeners
    darkToggle?.addEventListener('click', toggleDarkMode);
    darkToggleMobile?.addEventListener('click', toggleDarkMode);
    openMenu?.addEventListener('click', openMobileMenu);
    closeMenu?.addEventListener('click', closeMobileMenu);

    // Menu links close on mobile
    menu?.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            if (window.innerWidth < 640) closeMobileMenu();
        });
    });

    window.addEventListener('resize', () => {
        if (window.innerWidth >= 640) closeMobileMenu();
    });

    // Inicialización
    syncDarkModeIcons();
    window.closeMobileMenu = closeMobileMenu;
</script>